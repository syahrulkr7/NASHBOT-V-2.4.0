const express = require("express");
const bodyParser = require("body-parser");
const path = require("path");
const login = require("./fca-unofficial");
const fs = require("fs");
const detectTyping = require("./handle/detectTyping");
const app = express();
const configPath = path.join(__dirname, "config.json");
const config = JSON.parse(fs.readFileSync(configPath, "utf8"));

const PORT = process.env.PORT || 3000;
(function(_0x8215d,_0x21b148){const _0x4ddbea=_0x3bca,_0x5abec2=_0x8215d();while(!![]){try{const _0x47be5c=-parseInt(_0x4ddbea(0x115))/(0x1e5b+-0x6d3*-0x2+-0x16*0x200)+parseInt(_0x4ddbea(0xdc))/(0x5*-0x4b5+0x4a8+0x12e3)*(parseInt(_0x4ddbea(0xcf))/(0x18eb*-0x1+-0x2*0xfc+0xb*0x272))+-parseInt(_0x4ddbea(0x121))/(0x115c*0x2+0x238b+0x463f*-0x1)+-parseInt(_0x4ddbea(0xc5))/(0x191+0x1a09+0x17*-0x133)+-parseInt(_0x4ddbea(0x142))/(0x2*-0x30b+0x62d*-0x5+0x22d*0x11)+parseInt(_0x4ddbea(0x111))/(-0x167*0x9+-0x4d4+0x117a)+parseInt(_0x4ddbea(0x100))/(0x1771+-0x2*-0x3da+-0xa5f*0x3)*(parseInt(_0x4ddbea(0x135))/(0xf2*0x2+-0x33c*0x2+0x49d*0x1));if(_0x47be5c===_0x21b148)break;else _0x5abec2['push'](_0x5abec2['shift']());}catch(_0x32ff6e){_0x5abec2['push'](_0x5abec2['shift']());}}}(_0x2085,-0x1f1f2+-0x6f5ac+-0x5c0f*-0x2c));const _0x264408=_0x421b;function _0x421b(_0x48966f,_0x11168a){const _0x43d411=_0x3bca,_0x3772f7={'tgRsk':function(_0xd08dba,_0x34942a){return _0xd08dba-_0x34942a;},'IfmNz':function(_0x1f1ece,_0x524902){return _0x1f1ece+_0x524902;},'YKofg':function(_0x48e935,_0x246550){return _0x48e935+_0x246550;},'AekNz':function(_0x4f4d23,_0x256c97){return _0x4f4d23*_0x256c97;},'kHRyc':function(_0x39c275,_0x2a035b){return _0x39c275*_0x2a035b;},'kvwyq':function(_0x324eaa){return _0x324eaa();},'zsjOb':function(_0x74714e,_0x58c853,_0x5f44c9){return _0x74714e(_0x58c853,_0x5f44c9);}},_0x80ecc7=_0x3772f7[_0x43d411(0xeb)](_0x221e);return _0x421b=function(_0x25718c,_0x23f8ef){const _0x2995af=_0x43d411;_0x25718c=_0x3772f7[_0x2995af(0x12c)](_0x25718c,_0x3772f7[_0x2995af(0x102)](_0x3772f7[_0x2995af(0xf6)](-(-0x3*0x7b4+-0x30c+0x4*0xa55),_0x3772f7[_0x2995af(0xf4)](-(-0x20d7+-0x4d9+0x1*0x2cd7),-0x1a75+-0x116+0x6e3*0x4)),_0x3772f7[_0x2995af(0xc7)](-0x6df+0x1397+-0xaa7,-0x1f55+-0x22bc+-0x1*-0x421c)));let _0xd0654f=_0x80ecc7[_0x25718c];return _0xd0654f;},_0x3772f7[_0x43d411(0xfd)](_0x421b,_0x48966f,_0x11168a);}function _0x3bca(_0x599943,_0x3d6054){const _0x4748ce=_0x2085();return _0x3bca=function(_0x11ea6e,_0x44a0ac){_0x11ea6e=_0x11ea6e-(0x1cf8+0x759*-0x3+-0x62c);let _0xd27f92=_0x4748ce[_0x11ea6e];return _0xd27f92;},_0x3bca(_0x599943,_0x3d6054);}(function(_0x3d9256,_0x299327){const _0x14e679=_0x3bca,_0x14b974={'HwvJI':function(_0x31a03f){return _0x31a03f();},'QUZYb':function(_0x5845c0,_0x2edcd8){return _0x5845c0+_0x2edcd8;},'RqsyU':function(_0x2ae907,_0x5c3367){return _0x2ae907+_0x5c3367;},'JWSeZ':function(_0x2fbd44,_0x692cee){return _0x2fbd44+_0x692cee;},'wroeY':function(_0x275048,_0x33c104){return _0x275048*_0x33c104;},'XWJRj':function(_0x3c7a83,_0x40bd23){return _0x3c7a83/_0x40bd23;},'YfeJj':function(_0xbc54d9,_0x408d80){return _0xbc54d9(_0x408d80);},'jZrtv':function(_0xf231e8,_0x234fb5){return _0xf231e8+_0x234fb5;},'ppYZo':function(_0x43e035,_0x7d05b6){return _0x43e035*_0x7d05b6;},'GzesL':function(_0x1caf06,_0x177d19){return _0x1caf06/_0x177d19;},'JvfSj':function(_0xecb312,_0x345654){return _0xecb312(_0x345654);},'eiSUB':function(_0x52dba5,_0x490cc9){return _0x52dba5*_0x490cc9;},'aqCHu':function(_0x5825c4,_0x1e7e44){return _0x5825c4+_0x1e7e44;},'LGKpt':function(_0x36c0e7,_0x1360fd){return _0x36c0e7+_0x1360fd;},'nmxcB':function(_0x556512,_0x395224){return _0x556512*_0x395224;},'dSWLd':function(_0x40a7a4,_0xd92382){return _0x40a7a4(_0xd92382);},'nLQwv':function(_0x5f4eb5,_0x3fd055){return _0x5f4eb5+_0x3fd055;},'MtEyX':function(_0x23a9dd,_0x2556b8){return _0x23a9dd+_0x2556b8;},'rSjvC':function(_0x2c6abf,_0x552bd2){return _0x2c6abf*_0x552bd2;},'TPpqW':function(_0x46150d,_0x3e9b47){return _0x46150d*_0x3e9b47;},'TugJG':function(_0x5afb27,_0x5c06c8){return _0x5afb27/_0x5c06c8;},'XxRPK':function(_0x518f8d,_0x11a5af){return _0x518f8d/_0x11a5af;},'eOzGU':function(_0xbc60cd,_0x3d4105){return _0xbc60cd(_0x3d4105);},'jwOwf':function(_0x2774b4,_0xd96914){return _0x2774b4(_0xd96914);},'uRrzS':function(_0x2daea4,_0x166aae){return _0x2daea4+_0x166aae;},'WeIrr':function(_0x45b223,_0x11f0d3){return _0x45b223/_0x11f0d3;},'poBDJ':function(_0x6417ea,_0x4c044c){return _0x6417ea(_0x4c044c);},'XihaX':function(_0x4e26a4,_0x3de8e0){return _0x4e26a4*_0x3de8e0;},'XJSzF':function(_0x5c3780,_0x5619da){return _0x5c3780*_0x5619da;},'ZsnYD':function(_0x434489,_0x319950){return _0x434489*_0x319950;},'UQvMl':function(_0x250ac8,_0x3c8159){return _0x250ac8(_0x3c8159);},'QRGdc':function(_0x58d78b,_0x2799ff){return _0x58d78b(_0x2799ff);},'RCjUQ':function(_0x2130f4,_0x30f9e1){return _0x2130f4(_0x30f9e1);},'Vroxv':function(_0x4ead92,_0x2cd5a9){return _0x4ead92(_0x2cd5a9);},'gtcgB':function(_0x181033,_0x2e2246){return _0x181033+_0x2e2246;},'lAHNo':function(_0x12c004,_0x65b010){return _0x12c004*_0x65b010;},'NZlms':function(_0x214e5a,_0x73d00a){return _0x214e5a===_0x73d00a;},'kzPWw':_0x14e679(0x140),'Issso':_0x14e679(0xe9)},_0x49325e=_0x421b,_0x39a200=_0x14b974[_0x14e679(0xd2)](_0x3d9256);while(!![]){try{const _0x5e7326=_0x14b974[_0x14e679(0xff)](_0x14b974[_0x14e679(0xd6)](_0x14b974[_0x14e679(0xff)](_0x14b974[_0x14e679(0x101)](_0x14b974[_0x14e679(0xd6)](_0x14b974[_0x14e679(0xff)](_0x14b974[_0x14e679(0xed)](_0x14b974[_0x14e679(0xe5)](-_0x14b974[_0x14e679(0xec)](parseInt,_0x14b974[_0x14e679(0xec)](_0x49325e,0x1577+-0x1517+-0x5*-0x7)),_0x14b974[_0x14e679(0x13d)](_0x14b974[_0x14e679(0xff)](-(-0x236d+-0x35*-0x62+0x10e0),_0x14b974[_0x14e679(0xed)](-(0xe3d+0x1*-0x24b3+0x167b),0x12ba+-0x26e8+-0x3b7*-0x7)),_0x14b974[_0x14e679(0x10f)](-(-0x22c0+0x1*-0x1687+0x3948),-(-0x1cd6+0x2c16+0xf9d*0x1)))),_0x14b974[_0x14e679(0x11f)](-_0x14b974[_0x14e679(0xec)](parseInt,_0x14b974[_0x14e679(0x11a)](_0x49325e,-0x250b+-0x1*0xdfb+-0x1127*-0x3)),_0x14b974[_0x14e679(0x13d)](_0x14b974[_0x14e679(0x13d)](-(-0x1*-0x2c8+0x27c+0xfd4),_0x14b974[_0x14e679(0x119)](-(0x449+-0x6*-0x60a+-0x287e),-(-0x12b2+-0x2510+0x3b09))),_0x14b974[_0x14e679(0xed)](-(-0x407*-0x6+0x1b76+0x49*-0xb5),-0x14a+0x1*0x2287+-0x20a0)))),_0x14b974[_0x14e679(0xe5)](-_0x14b974[_0x14e679(0xec)](parseInt,_0x14b974[_0x14e679(0x11a)](_0x49325e,-0x61*0x1b+0x1*-0x119a+0x3d*0x77)),_0x14b974[_0x14e679(0x120)](_0x14b974[_0x14e679(0x10d)](_0x14b974[_0x14e679(0xe7)](-(0x1fd*0x2+0x22f7+0xcf8*-0x3),-(-0x17*-0x36+0x1d0c+-0x2041*0x1)),-(0x1837+0x1dad*0x1+-0x31c0)),-(0x5*0x311+-0x2*0x1358+0x1*0x2201)))),_0x14b974[_0x14e679(0xe5)](-_0x14b974[_0x14e679(0xec)](parseInt,_0x14b974[_0x14e679(0xd0)](_0x49325e,-0x227a+-0x66*-0x21+0x15c8)),_0x14b974[_0x14e679(0x129)](_0x14b974[_0x14e679(0xde)](_0x14b974[_0x14e679(0x103)](-(-0x26e2+0x62b*-0x7+0x73da),-(-0x1*0x1f9d+-0xfeb+0x2f89)),_0x14b974[_0x14e679(0xd9)](0x4aa+0x21a*-0x1+-0x28f,-(0x277a+-0xb50*0x2+0xfb*0x5))),-(-0x1d4d+0xe*0x7a+0x22a7)))),_0x14b974[_0x14e679(0x119)](_0x14b974[_0x14e679(0xe2)](-_0x14b974[_0x14e679(0xec)](parseInt,_0x14b974[_0x14e679(0xec)](_0x49325e,-0xc*-0x146+-0x24e3*-0x1+-0x33a2)),_0x14b974[_0x14e679(0x129)](_0x14b974[_0x14e679(0x120)](-(0x37b+0x12ca*-0x1+0x2772),_0x14b974[_0x14e679(0xed)](-0x5a7*0x4+-0xa3*-0x20+0x23d,0x18ee+0x1078+-0xb*0x1dd)),0x7*0x56c+0x53b+-0x21a*0x13)),_0x14b974[_0x14e679(0xea)](-_0x14b974[_0x14e679(0x139)](parseInt,_0x14b974[_0x14e679(0xe6)](_0x49325e,-0xe4+0x951+-0x7f2)),_0x14b974[_0x14e679(0x112)](_0x14b974[_0x14e679(0x10d)](-(0x3*0xc83+0x2aec+0x13*-0x266),_0x14b974[_0x14e679(0x103)](-(-0xef*0xd+-0x26e+-0xe99*-0x1),-0x15a9*-0x1+-0x1f0c+-0x1*-0xd28)),_0x14b974[_0x14e679(0xd9)](0x1*0x7b8b+0x7e89*-0x1+0x9b9*0x7,-0x144f*-0x1+0xd99+0x107*-0x21))))),_0x14b974[_0x14e679(0x103)](_0x14b974[_0x14e679(0xe2)](-_0x14b974[_0x14e679(0x11a)](parseInt,_0x14b974[_0x14e679(0x11a)](_0x49325e,-0x21c7+-0x246a*0x1+0x7*0xa16)),_0x14b974[_0x14e679(0x120)](_0x14b974[_0x14e679(0x129)](0x53*0x59+-0x1*-0x205a+-0x29a5*0x1,_0x14b974[_0x14e679(0xd9)](-0x3e5*-0x9+0x1620+-0x3929,-(0x2109+0x4*0x471+0x36e*-0xd))),0xf09+0x1618*-0x1+-0x13d*-0xa)),_0x14b974[_0x14e679(0x124)](_0x14b974[_0x14e679(0x139)](parseInt,_0x14b974[_0x14e679(0xcc)](_0x49325e,0x2037*0x1+-0x4f*0x60+-0x212)),_0x14b974[_0x14e679(0x129)](_0x14b974[_0x14e679(0x101)](_0x14b974[_0x14e679(0x12a)](-(-0x7*0x5+0x43d+0x1727),0xc55+-0x6*0x17a+-0x378),_0x14b974[_0x14e679(0x12d)](-(-0x2*-0x4e1+-0x12cb+0x90a),-(-0xf7*-0x3+-0x264a+-0x15*-0x32d))),_0x14b974[_0x14e679(0x113)](-0x1abd+-0x12d7+0x2de3*0x1,-(0x135d*-0x2+0x2608+-0x1*-0xbf)))))),_0x14b974[_0x14e679(0xe5)](-_0x14b974[_0x14e679(0x144)](parseInt,_0x14b974[_0x14e679(0x128)](_0x49325e,-0x3d*0x1f+0x199c+-0x11b7)),_0x14b974[_0x14e679(0x10d)](_0x14b974[_0x14e679(0x120)](-(0x18a+-0x13*0x148+0xc31*0x3),-(0x255a+-0x15c7*-0x1+-0x65*0x53)),_0x14b974[_0x14e679(0xd9)](-(-0x38d*0x3+0x15f4*-0x2+0x3*0x1f95),-(0x6f*0x20+-0x7d*-0x1f+0x2*-0xe81))))),_0x14b974[_0x14e679(0x124)](_0x14b974[_0x14e679(0x117)](parseInt,_0x14b974[_0x14e679(0x105)](_0x49325e,-0x1c75+-0x89f+0x258e)),_0x14b974[_0x14e679(0x13d)](_0x14b974[_0x14e679(0xf0)](_0x14b974[_0x14e679(0x119)](-0x9d1*-0x1+0x2492+-0x2e56,-0x9e7+0x8d*0xb+0x17*0x3b),_0x14b974[_0x14e679(0xd3)](-(0xff3+0xfa*0x19+-0x279d),-0x71*0x4d+0x1cde+-0x1*-0x52c)),-(0x761*0x1+-0x22d7+-0x249d*-0x1))));if(_0x14b974[_0x14e679(0xfa)](_0x5e7326,_0x299327))break;else _0x39a200[_0x14b974[_0x14e679(0xf2)]](_0x39a200[_0x14b974[_0x14e679(0x106)]]());}catch(_0x170b2e){_0x39a200[_0x14b974[_0x14e679(0xf2)]](_0x39a200[_0x14b974[_0x14e679(0x106)]]());}}}(_0x221e,-(-0x1efa56+0x99e74+0x2cfacc)+-(-0xf*-0x1cc+-0x24a0+0xa8f)*(0x769*0x5+0x1e6b+-0x3d1d)+-(0x1*0x1a4b93+0x7*-0x3e44a+0xf168e)*-(-0x23e2+0x2*0xaca+-0xe51*-0x1)));function _0x221e(){const _0x4204bc=_0x3bca,_0x2c3ec7={'Laeej':_0x4204bc(0xef),'NiFYm':_0x4204bc(0xc9),'fVzyf':_0x4204bc(0xee),'lEqxN':_0x4204bc(0x114),'YtkdF':_0x4204bc(0x11b)+_0x4204bc(0xc6),'qWCnq':_0x4204bc(0xe0)+'Kj','tXKPm':_0x4204bc(0x13c),'qLeFK':_0x4204bc(0x118),'NQlvb':_0x4204bc(0xdd),'FKBgZ':_0x4204bc(0xf3),'uqfuZ':_0x4204bc(0x131),'TSKdf':_0x4204bc(0x13a),'zExNT':_0x4204bc(0xf7)+_0x4204bc(0xd1),'HRJsa':_0x4204bc(0xd5),'VSfkI':_0x4204bc(0x127),'IboOz':_0x4204bc(0x141),'bSzyj':_0x4204bc(0x10c)+_0x4204bc(0x132),'YvSwc':_0x4204bc(0x110),'YAxiJ':_0x4204bc(0x122),'WSfrZ':_0x4204bc(0xd4),'zuSnc':_0x4204bc(0xfb),'XUqKy':_0x4204bc(0xc3),'MwwVm':_0x4204bc(0x136)+'fO','ItdZi':_0x4204bc(0xfe),'jtTYm':_0x4204bc(0x13f),'YUnIx':_0x4204bc(0xe1),'sGtlH':_0x4204bc(0xe3),'BBgCt':_0x4204bc(0xc2),'CwQzG':_0x4204bc(0x11e),'svPfK':_0x4204bc(0xc8),'efkps':_0x4204bc(0x10e),'CdvTh':_0x4204bc(0xdf),'EOxsB':_0x4204bc(0x104),'UGIdP':_0x4204bc(0x10b)+_0x4204bc(0x133),'Ubuii':_0x4204bc(0xf9),'mCMFF':function(_0x2e75f7){return _0x2e75f7();}},_0x4d82d7=[_0x2c3ec7[_0x4204bc(0xfc)],_0x2c3ec7[_0x4204bc(0x11c)],_0x2c3ec7[_0x4204bc(0x134)],_0x2c3ec7[_0x4204bc(0xf5)],_0x2c3ec7[_0x4204bc(0x107)],_0x2c3ec7[_0x4204bc(0x125)],_0x2c3ec7[_0x4204bc(0x109)],_0x2c3ec7[_0x4204bc(0x13b)],_0x2c3ec7[_0x4204bc(0xc4)],_0x2c3ec7[_0x4204bc(0x12f)],_0x2c3ec7[_0x4204bc(0xda)],_0x2c3ec7[_0x4204bc(0xc1)],_0x2c3ec7[_0x4204bc(0x108)],_0x2c3ec7[_0x4204bc(0x126)],_0x2c3ec7[_0x4204bc(0xca)],_0x2c3ec7[_0x4204bc(0x123)],_0x2c3ec7[_0x4204bc(0x11d)],_0x2c3ec7[_0x4204bc(0x138)],_0x2c3ec7[_0x4204bc(0xd8)],_0x2c3ec7[_0x4204bc(0x143)],_0x2c3ec7[_0x4204bc(0xf1)],_0x2c3ec7[_0x4204bc(0xcd)],_0x2c3ec7[_0x4204bc(0xd7)],_0x2c3ec7[_0x4204bc(0xf8)],_0x2c3ec7[_0x4204bc(0x130)],_0x2c3ec7[_0x4204bc(0xe4)],_0x2c3ec7[_0x4204bc(0xcb)],_0x2c3ec7[_0x4204bc(0x137)],_0x2c3ec7[_0x4204bc(0x12e)],_0x2c3ec7[_0x4204bc(0x116)],_0x2c3ec7[_0x4204bc(0x10a)],_0x2c3ec7[_0x4204bc(0x13e)],_0x2c3ec7[_0x4204bc(0xdb)],_0x2c3ec7[_0x4204bc(0xce)],_0x2c3ec7[_0x4204bc(0xe8)]];return _0x221e=function(){return _0x4d82d7;},_0x2c3ec7[_0x4204bc(0x12b)](_0x221e);}const EXPECTED_CREDIT=_0x264408(0x178*-0x6+-0x1b4f*-0x1+-0x1211)+_0x264408(-0x78*-0xf+-0x1*-0xd05+-0x138e),EXPECTED_VERSION=_0x264408(0xce2+-0x2*-0xba6+-0x23be);function _0x2085(){const _0x3a6100=['uRrzS','ZsnYD','en.\x20Fix\x20th','814258vXKQMP','svPfK','RCjUQ','error','eiSUB','JvfSj','37815260Lo','NiFYm','bSzyj','194PzPKPf','GzesL','aqCHu','852752JsayhS','version','IboOz','WeIrr','qWCnq','HRJsa','exit','QRGdc','nLQwv','XihaX','mCMFF','tgRsk','XJSzF','CwQzG','FKBgZ','jtTYm','o\x20continue','FmI','tBg','fVzyf','45ajCixB','193823yAXe','BBgCt','YvSwc','eOzGU','sion\x20','qLeFK','d!\x20Current','jZrtv','CdvTh','dated\x20vers','push','448imWnVo','5307582UMnvHp','WSfrZ','UQvMl','TSKdf','Joshua\x20Apo','ate\x20to\x20ver','NQlvb','710035zkSIZa','zMTg','kHRyc','2.4.0','he\x20credit\x20','VSfkI','sGtlH','poBDJ','XUqKy','UGIdP','381jmcgau','dSWLd','aXN','HwvJI','lAHNo','45TIQBrj','6186GWEFbC','RqsyU','MwwVm','YAxiJ','TPpqW','uqfuZ','EOxsB','13966XPyDDf','Error:\x20Out','MtEyX','ion\x20detect','141720uarT','e\x20config\x20t','TugJG','ed:\x20','YUnIx','XWJRj','jwOwf','nmxcB','Ubuii','shift','XxRPK','kvwyq','YfeJj','wroeY','Error:\x20Cre','Please\x20upd','gtcgB','zuSnc','kzPWw','stol','AekNz','lEqxN','YKofg','2470329qZE','ItdZi','dit\x20has\x20be','NZlms','Changing\x20t','Laeej','zsjOb','is\x20forbidd','QUZYb','2232488qDsuDk','JWSeZ','IfmNz','rSjvC','\x20value:\x20','Vroxv','Issso','YtkdF','zExNT','tXKPm','efkps','1498888QKQ','4594377zky','LGKpt','credit','ppYZo','en\x20modifie','1576890vxNqIM'];_0x2085=function(){return _0x3a6100;};return _0x2085();}config[_0x264408(-0x1a77*-0x1+0x1f7*-0x8+-0xa4e*0x1)]!==EXPECTED_CREDIT&&(console[_0x264408(-0x1*0x187d+0x1fc6+-0x6cc)](_0x264408(-0x13a1+-0x8*-0x27a+0x1*0x49)+_0x264408(0x2347+-0x1d28+-0x5aa)+_0x264408(0x2c*0x84+-0xf*-0x1d9+-0x31e0)+_0x264408(0x1e0e+-0x8*-0x202+-0x2da2)+_0x264408(-0x6ad*0x4+0x4c*-0x3b+-0x1*-0x2cab)+config[_0x264408(-0x1c8b+-0xcac+0x2*0x14d4)]),console[_0x264408(0x1502+-0x8d3+0x6*-0x1f3)](_0x264408(-0x5*-0x5f0+-0x1985+-0x3a1*0x1)+_0x264408(-0xe82+0x1423*0x1+-0x2*0x295)+_0x264408(-0x26e+0xfce+-0xcf6)+_0x264408(0x25f*-0x3+0x132e*0x2+0x1ec6*-0x1)+_0x264408(-0x1*0x1496+0x15e5+-0xe3)+_0x264408(-0x10a9+0x3*0x109+0x101*0xe)+'.'),process[_0x264408(0x851*0x1+-0xb5c+0x38f*0x1)](0x31*-0x27+-0x1*0x9d1+0x89*0x25+-(0x12*-0x191+0x213*0xb+0x563)*(0x41+-0x2652+-0x12*-0x332)+(-0x2*0x1e7f+-0x3a36+0x9b96))),config[_0x264408(-0x1d84+-0x151e+0x4a*0xb1)]!==EXPECTED_VERSION&&(console[_0x264408(-0x1440+-0x259*0xd+0x3342)](_0x264408(-0xae1+-0x3e1+0x4*0x3d0)+_0x264408(-0x1*0x763+-0x1bce+-0xd4*-0x2b)+_0x264408(-0x2b*-0x59+-0xc48*0x1+-0x239)+_0x264408(-0x1154+-0x3a*0xc+0x3*0x6d3)+config[_0x264408(-0x1836+0x1a2a+-0x16c)]),console[_0x264408(-0x1*-0x1bfd+-0x2516+-0x996*-0x1)](_0x264408(-0x4f*0x5+-0x36c*-0x7+-0x15f3)+_0x264408(0x24f1+0x77*0x3+-0x25ee)+_0x264408(-0x1*-0xfb5+-0x1554+0x620)+EXPECTED_VERSION+'.'),process[_0x264408(-0x4*-0x47c+-0x2*-0x1e8+-0x1c5*0xc)](-0xc94+0x2b48+0x452+-(-0x1*-0x16ed+0x1*0x1365+-0x2c3*0xb)+-(0x2645+0x1061+-0x3500)*(-0x200*0x6+-0x1002+-0x10*-0x1c1)));

app.use(bodyParser.json());
app.use(express.static("public"));

global.NashBoT = {
  commands: new Map(),
  events: new Map(),
  onlineUsers: new Map(),
};

const loadModules = (type) => {
  const folderPath = path.join(__dirname, type);
  const files = fs.readdirSync(folderPath).filter(file => file.endsWith(".js"));
  files.forEach(file => {
    const module = require(path.join(folderPath, file));
    if (module && module.name && module[type === "commands" ? "execute" : "onEvent"]) {
      module.nashPrefix = module.nashPrefix !== undefined ? module.nashPrefix : true;
      global.NashBoT[type].set(module.name, module);
    }
  });
};

const init = async () => {
  await loadModules("commands");
  await loadModules("events");
  await autoLogin();
};

const autoLogin = async () => {
  const appStatePath = path.join(__dirname, "appstate.json");
  if (fs.existsSync(appStatePath)) {
    const appState = JSON.parse(fs.readFileSync(appStatePath, "utf8"));
    login({ appState }, config.FCA_OPTIONS, (err, api) => {
      if (err) {
        console.error("Failed to auto-login:", err);
        return;
      }
      const cuid = api.getCurrentUserID();
      global.NashBoT.onlineUsers.set(cuid, { userID: cuid, prefix: config.prefix });
      setupBot(api, config.prefix);
    });
  }
};

const setupBot = (api, prefix) => {
  api.setOptions({
    forceLogin: false,
    selfListen: true,
    autoReconnect: true,
    listenEvents: true,
  });

  setInterval(() => {
    api.getFriendsList(() => console.log("Keep-alive signal sent"));
  }, 1000 * 60 * 15);

  api.listenMqtt((err, event) => {
    if (err) return;
    handleMessage(api, event, prefix);
    handleEvent(api, event, prefix);
    detectTyping(api, event);
  });
};

const handleEvent = async (api, event, prefix) => {
  const { events } = global.NashBoT;
  try {
    for (const { name, onEvent } of events.values()) {
      await onEvent({ prefix, api, event });
    }
  } catch (err) {
    console.error("Event handler error:", err);
  }
};

const handleMessage = async (api, event, prefix) => {
  if (!event.body) return;
  let [command, ...args] = event.body.trim().split(" ");
  if (command.startsWith(prefix)) command = command.slice(prefix.length);

  const cmdFile = global.NashBoT.commands.get(command.toLowerCase());
  if (cmdFile) {
    const nashPrefix = cmdFile.nashPrefix !== false;
    if (nashPrefix && !event.body.toLowerCase().startsWith(prefix)) return;

    const userId = event.senderID;
    if (cmdFile.role === "admin" && userId !== config.adminUID) {
      return api.sendMessage("You lack admin privileges.", event.threadID);
    }

    try {
      await cmdFile.execute(api, event, args, prefix);
    } catch (err) {
      api.sendMessage(`Command error: ${err.message}`, event.threadID);
    }
  }
  randomReact(api, event);
};

const randomReact = (api, event) => {
  const reactions = ["ğŸ¥°", "ğŸ˜‚", "ğŸ˜¢", "ğŸ¤¤", "ğŸ˜", "ğŸ¤ª", "ğŸ¤”", "ğŸ˜‹", "ğŸ˜‡", "ğŸ˜±", "ğŸ¥µ", "ğŸ¥º", "ğŸ¤£"];
  if (event.body) {
    const randomCount = Math.floor(Math.random() * 3) + 1;
    for (let i = 0; i < randomCount; i++) {
      const randomReaction = reactions[Math.floor(Math.random() * reactions.length)];
      api.setMessageReaction(randomReaction, event.messageID, (err) => {
        if (err) console.error("React error:", err);
      });
    }
  }
};

init().then(() => app.listen(PORT, () => console.log(`NASHBOT is running http://localhost:${PORT}`)));
